!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("domql",[],e):"object"==typeof exports?exports.domql=e():r.domql=e()}("undefined"!=typeof self?self:this,function(){return function(r){var e={};function t(n){if(e[n])return e[n].exports;var u=e[n]={i:n,l:!1,exports:{}};return r[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var u in r)t.d(n,u,function(e){return r[e]}.bind(null,u));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=2)}([function(r,e,t){"use strict";function n(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.QueryEngine=void 0;var u=function(){function r(){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r)}var e,t,u;return e=r,u=[{key:"getEngine",value:function(){return r._querySelector}},{key:"setEngine",value:function(e){r._querySelector=e}},{key:"useDefault",value:function(){r._querySelector=r.defaultQuerySelector}},{key:"defaultQuerySelector",value:function(r){return Array.from(document.querySelectorAll(r))}}],(t=null)&&n(e.prototype,t),u&&n(e,u),r}();e.QueryEngine=u,u._querySelector=u.defaultQuerySelector},function(r,e,t){"use strict";function n(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0}),e.Directives=void 0;var u=function(){function r(){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r)}var e,t,u;return e=r,u=[{key:"sort",value:function(r,e){return e.sort(r),e}},{key:"limiter",value:function(r,e){return e.slice(0,r)}},{key:"execute",value:function(r,e,t){if(!r)return[];for(var n=e(r),u=0;u<t.length;u++)n=t[u](n);return n}}],(t=null)&&n(e.prototype,t),u&&n(e,u),r}();e.Directives=u},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$=function(r){return new c(r).execute()},e.$$=function(r){return new c(r)},Object.defineProperty(e,"QueryEngine",{enumerable:!0,get:function(){return i.QueryEngine}}),e.Domql=void 0;var n=t(3),u=t(5),o=t(1),i=t(0);function a(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}var c=function(){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this._name="Domql",this._queryModel={},this.compile(e)}var e,t,i;return e=r,(t=[{key:"compile",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._query=r,r){var e=n.Parser.parse(r);this._queryModel=u.Transpiler.transpile(e)}}},{key:"execute",value:function(){return o.Directives.execute(this._queryModel.selector,this._queryModel.engine,this._queryModel.directives)}},{key:"name",get:function(){return this._name}},{key:"query",get:function(){return this._query}}])&&a(e.prototype,t),i&&a(e,i),r}();e.Domql=c},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var n=t(4);function u(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}var o=function(){function r(){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r)}var e,t,o;return e=r,o=[{key:"parse",value:function(r){return(0,n.parse)(r)}}],(t=null)&&u(e.prototype,t),o&&u(e,o),r}();e.Parser=o},function(r,e,t){"use strict";function n(r,e,t,u){this.message=r,this.expected=e,this.found=t,this.location=u,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}function u(r,e){e=void 0!==e?e:{};var t,u={},o={start:et},i=et,a="!",c="=",f=">=",l=">",s="<=",v="<>",p="<",h="!=",d='"',y="'",b="`",g="*",m=".",A="null",C="true",_="false",E="select",w="from",x="where",S="group",O="by",L="order",j="limit",T="asc",k="desc",R="in",D="is",P="like",M="exists",q="not",I="and",N="or",F=",",Q="(",U=")",z=/^[^"]/,Z=/^[^']/,W=/^[^`]/,K=/^[A-Za-z_]/,X=/^[A-Za-z0-9_]/,$=/^[A-Za-z0-9_:]/,B=/^[0-9]/,G=/^[eE]/,H=/^[+\-]/,Y=/^[ \t\n\r]/,J=Xe("!",!1),V=Xe("=",!1),rr=Xe(">=",!1),er=Xe(">",!1),tr=Xe("<=",!1),nr=Xe("<>",!1),ur=Xe("<",!1),or=Xe("!=",!1),ir=Xe('"',!1),ar=$e(['"'],!0,!1),cr=Xe("'",!1),fr=$e(["'"],!0,!1),lr=Xe("`",!1),sr=$e(["`"],!0,!1),vr=$e([["A","Z"],["a","z"],"_"],!1,!1),pr=$e([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),hr=$e([["A","Z"],["a","z"],["0","9"],"_",":"],!1,!1),dr=Xe(".",!1),yr=$e([["0","9"]],!1,!1),br=$e(["e","E"],!1,!1),gr=$e(["+","-"],!1,!1),mr=Xe("NULL",!0),Ar=Xe("TRUE",!0),Cr=Xe("FALSE",!0),_r=Xe("SELECT",!0),Er=Xe("FROM",!0),wr=Xe("WHERE",!0),xr=Xe("GROUP",!0),Sr=Xe("BY",!0),Or=Xe("ORDER",!0),Lr=Xe("LIMIT",!0),jr=Xe("ASC",!0),Tr=Xe("DESC",!0),kr=Xe("IN",!0),Rr=Xe("IS",!0),Dr=Xe("LIKE",!0),Pr=Xe("EXISTS",!0),Mr=Xe("NOT",!0),qr=Xe("AND",!0),Ir=Xe("OR",!0),Nr=Xe(",",!1),Fr=Xe("*",!1),Qr=Xe("(",!1),Ur=Xe(")",!1),zr=$e([" ","\t","\n","\r"],!1,!1),Zr=function(r,e,t,n,u,o){return{type:"select",columns:r,from:e,where:t,groupby:n,orderby:u,limit:o}},Wr=function(){return[{type:"column_ref",column:"*"}]},Kr=function(r,e){return Kt(r,e)},Xr=function(r){return r},$r=function(r){return r},Br=function(){return{type:"table_ref",table:"*"}},Gr=function(r){return{type:"table_ref",table:r}},Hr=function(r){return r},Yr=function(r,e){var t=r;return t.order="ASC","DESC"===e&&(t.order="DESC"),t},Jr=function(r){return r},Vr=function(r,e){var t={type:"expr_list"};return t.value=Kt(r,e),t},re=function(r,e){return Xt(r,e)},ee=function(r){return Zt("NOT",r)},te=function(r,e){return null===e?r:"arithmetic"===e.type?Xt(r,e.tail):Wt(e.op,r,e.right)},ne=function(r,e){return e.parentheses=!0,Zt(r,e)},ue=function(r){return r[0]+" "+r[2]},oe=function(r){return{type:"arithmetic",tail:r}},ie=function(r){return{op:"IS",right:r}},ae=function(r){return{op:"IS NOT",right:r}},ce=function(r,e){return{op:r,right:e}},fe=function(r,e){return{op:r,right:e}},le=function(r,e){return Xt(r,e)},se=function(r){return r.parentheses=!0,r},ve=function(r){return r.parentheses=!0,r},pe=function(r,e){return{type:"column_ref",column:r,field:e}},he=function(r){return{type:"column_ref",column:r}},de=function(r){return!0===zt[r.toUpperCase()]},ye=function(r){return r},be=function(r){return r.join("")},ge=function(r){return r},me=function(r,e){return r+e.join("")},Ae=function(){return{type:"null",value:null}},Ce=function(){return{type:"bool",value:!0}},_e=function(){return{type:"bool",value:!1}},Ee=function(r){return{type:"string",value:r}},we=function(r){return{type:"number",value:r}},xe=function(r,e,t){return parseFloat(r+e+t)},Se=function(r,e){return parseFloat(r+e)},Oe=function(r,e){return parseFloat(r+e)},Le=function(r){return parseFloat(r)},je=function(r){return"."+r},Te=function(r,e){return r+e},ke=function(r){return r.join("")},Re=function(r,e){return r+(null!==e?e:"")},De=function(){return"ASC"},Pe=function(){return"DESC"},Me=function(){return"IN"},qe=function(){return"IS"},Ie=function(){return"LIKE"},Ne=function(){return"EXISTS"},Fe=function(){return"NOT"},Qe=function(){return"AND"},Ue=function(){return"OR"},ze=0,Ze=[{line:1,column:1}],We=[],Ke=0;if("startRule"in e){if(!(e.startRule in o))throw new Error("Can't start parsing from rule \""+e.startRule+'".');i=o[e.startRule]}function Xe(r,e){return{type:"literal",text:r,ignoreCase:e}}function $e(r,e,t){return{type:"class",parts:r,inverted:e,ignoreCase:t}}function Be(e){var t,n=Ze[e];if(n)return n;for(t=e-1;!Ze[t];)t--;for(n={line:(n=Ze[t]).line,column:n.column};t<e;)10===r.charCodeAt(t)?(n.line++,n.column=1):n.column++,t++;return Ze[e]=n,n}var Ge="string"==typeof e.filename&&e.filename.length>0;function He(r,t){var n={};Ge&&(n.filename=e.filename);var u=Be(r);n.start={offset:r,line:u.line,column:u.column};var o=Be(t);return n.end={offset:t,line:o.line,column:o.column},n}function Ye(){We.push({pos:ze,variants:[]})}function Je(r){var e=We[We.length-1];ze<e.pos||(ze>e.pos&&(e.pos=ze,e.variants=[]),e.variants.push(r))}function Ve(r){var e=We.pop(),t=We[We.length-1],n=e.variants;t.pos===e.pos&&(r&&(n=n.map(function(r){return"not"===r.type?r.expected:{type:"not",expected:r}})),Array.prototype.push.apply(t.variants,n))}function rt(r,e,t){return new n(n.buildMessage(r,e),r,e,t)}function et(){return tt()}function tt(){var e,t,n,o,i,a,c;return e=ze,Qt(),function(){var e,t,n,o;e=ze,i=_r,0===Ke&&Je(i),r.substr(ze,6).toLowerCase()===E?(t=r.substr(ze,6),ze+=6):t=u;var i;t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u);return e}()!==u?(Qt(),(t=function(){var r,e,t,n,o,i,a,c;r=ze,e=ze,(t=It())!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u);e!==u&&(r,e=Wr());if((r=e)===u)if(r=ze,(e=nt())!==u){for(t=[],n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=nt())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=nt())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=Kr(e,t)}else ze=r,r=u;return r}())!==u?(Qt(),(n=function(){var e,t;e=ze,function(){var e,t,n,o,i;return e=ze,i=Er,0===Ke&&Je(i),r.substr(ze,4).toLowerCase()===w?(t=r.substr(ze,4),ze+=4):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}()!==u?(Qt(),(t=function(){var r,e,t,n,o;r=ze,e=ze,(t=It())!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u);e!==u&&(r,e=Br());(r=e)===u&&(r=ze,(e=dt())!==u&&(r,e=Gr(e)),r=e);return r}())!==u?(e,e=$r(t)):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(n=null),Qt(),(o=function(){var e,t;e=ze,function(){var e,t,n,o,i;return e=ze,i=wr,0===Ke&&Je(i),r.substr(ze,5).toLowerCase()===x?(t=r.substr(ze,5),ze+=5):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}()!==u?(Qt(),(t=it())!==u?(e,e=Hr(t)):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(o=null),Qt(),(i=function(){var e,t;e=ze,function(){var e,t,n,o,i;return e=ze,i=xr,0===Ke&&Je(i),r.substr(ze,5).toLowerCase()===S?(t=r.substr(ze,5),ze+=5):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}()!==u?(Qt(),Lt()!==u?(Qt(),(t=function(){var r,e,t,n,o,i,a,c;if(r=ze,(e=ht())!==u){for(t=[],n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=ht())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=ht())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=Kr(e,t)}else ze=r,r=u;return r}())!==u?(e,e=$r(t)):(ze=e,e=u)):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(i=null),Qt(),(a=function(){var e,t;e=ze,function(){var e,t,n,o,i;return e=ze,i=Or,0===Ke&&Je(i),r.substr(ze,5).toLowerCase()===L?(t=r.substr(ze,5),ze+=5):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}()!==u?(Qt(),Lt()!==u?(Qt(),(t=function(){var r,e,t,n,o,i,a,c;if(r=ze,(e=ut())!==u){for(t=[],n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=ut())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=ut())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=Kr(e,t)}else ze=r,r=u;return r}())!==u?(e,e=$r(t)):(ze=e,e=u)):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(a=null),Qt(),(c=function(){var e,t;e=ze,function(){var e,t,n,o,i;return e=ze,i=Lr,0===Ke&&Je(i),r.substr(ze,5).toLowerCase()===j?(t=r.substr(ze,5),ze+=5):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}()!==u?(Qt(),(t=_t())!==u?(e,e=Jr(t)):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(c=null),e,e=Zr(t,n,o,i,a,c)):(ze=e,e=u)):(ze=e,e=u),e}function nt(){var r,e;return r=ze,(e=ht())!==u&&(r,e=Xr(e)),r=e}function ut(){var e,t,n;return e=ze,(t=ht())!==u?(Qt(),(n=function(){var e,t,n,o;e=ze,i=Tr,0===Ke&&Je(i),r.substr(ze,4).toLowerCase()===k?(t=r.substr(ze,4),ze+=4):t=u;var i;t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Pe()):(ze=e,e=u)):(ze=e,e=u);return e}())===u&&(n=function(){var e,t,n,o;e=ze,i=jr,0===Ke&&Je(i),r.substr(ze,3).toLowerCase()===T?(t=r.substr(ze,3),ze+=3):t=u;var i;t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=De()):(ze=e,e=u)):(ze=e,e=u);return e}()),n===u&&(n=null),e,e=Yr(t,n)):(ze=e,e=u),e}function ot(){var r,e,t,n,o,i,a,c;if(r=ze,(e=it())!==u){for(t=[],n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=it())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=qt())!==u?(a=Qt(),(c=it())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=Vr(e,t)}else ze=r,r=u;return r}function it(){var r,e,t,n,o,i,a,c;if(r=ze,(e=at())!==u){for(t=[],n=ze,o=Qt(),(i=Mt())!==u?(a=Qt(),(c=at())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=Mt())!==u?(a=Qt(),(c=at())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=re(e,t)}else ze=r,r=u;return r}function at(){var r,e,t,n,o,i,a,c;if(r=ze,(e=ct())!==u){for(t=[],n=ze,o=Qt(),(i=Pt())!==u?(a=Qt(),(c=ct())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=Pt())!==u?(a=Qt(),(c=ct())!==u?n=o=[o,i,a,c]:(ze=n,n=u)):(ze=n,n=u);r,r=re(e,t)}else ze=r,r=u;return r}function ct(){var e,t,n,o,i,f=function(r){0===Ke&&Je(r)};return(e=ft())===u&&(e=function(){var r,e,t;r=ze,(e=function(){var r,e,t,n,o;return r=ze,e=ze,(t=Dt())!==u?(n=Qt(),(o=Rt())!==u?e=t=[t,n,o]:(ze=e,e=u)):(ze=e,e=u),e!==u&&(r,e=ue(e)),(r=e)===u&&(r=Rt()),r}())!==u?(Qt(),Nt()!==u?(Qt(),(t=tt())!==u?(Qt(),Ft()!==u?(r,r=ne(e,t)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u);return r}())===u&&(e=ze,(t=Dt())===u&&(t=ze,f(J),33===r.charCodeAt(ze)?(n=a,ze++):n=u,n!==u?(o=ze,Ye(),f(V),61===r.charCodeAt(ze)?(i=c,ze++):i=u,Ve(!0),i===u?o=void 0:(ze=o,o=u),o!==u?t=n=[n,o]:(ze=t,t=u)):(ze=t,t=u)),t!==u?(n=Qt(),(o=ct())!==u?(e,e=ee(o)):(ze=e,e=u)):(ze=e,e=u)),e}function ft(){var r,e,t;return r=ze,(e=st())!==u?(Qt(),(t=function(){var r;(r=function(){var r,e,t,n,o,i,a;if(r=ze,e=[],t=ze,n=Qt(),(o=lt())!==u?(i=Qt(),(a=st())!==u?t=n=[n,o,i,a]:(ze=t,t=u)):(ze=t,t=u),t!==u)for(;t!==u;)e.push(t),t=ze,n=Qt(),(o=lt())!==u?(i=Qt(),(a=st())!==u?t=n=[n,o,i,a]:(ze=t,t=u)):(ze=t,t=u);else e=u;return e!==u&&(r,e=oe(e)),r=e}())===u&&(r=function(){var r,e,t;r=ze,(e=function(){var r,e,t,n,o;return r=ze,e=ze,(t=Dt())!==u?(n=Qt(),(o=jt())!==u?e=t=[t,n,o]:(ze=e,e=u)):(ze=e,e=u),e!==u&&(r,e=ue(e)),(r=e)===u&&(r=jt()),r}())!==u?(Qt(),Nt()!==u?(Qt(),(t=ot())!==u?(Qt(),Ft()!==u?(r,r=fe(e,t)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u);return r}())===u&&(r=function(){var r,e,t,n,o;r=ze,(e=Tt())!==u?(t=Qt(),(n=st())!==u?(r,r=ie(n)):(ze=r,r=u)):(ze=r,r=u);r===u&&(r=ze,e=ze,(t=Tt())!==u?(n=Qt(),(o=Dt())!==u?e=t=[t,n,o]:(ze=e,e=u)):(ze=e,e=u),e!==u?(t=Qt(),(n=st())!==u?(r,r=ae(n)):(ze=r,r=u)):(ze=r,r=u));return r}())===u&&(r=function(){var r,e,t;r=ze,(e=function(){var r,e,t,n,o;return r=ze,e=ze,(t=Dt())!==u?(n=Qt(),(o=kt())!==u?e=t=[t,n,o]:(ze=e,e=u)):(ze=e,e=u),e!==u&&(r,e=ue(e)),(r=e)===u&&(r=kt()),r}())!==u?(Qt(),(t=ft())!==u?(r,r=ce(e,t)):(ze=r,r=u)):(ze=r,r=u);return r}());return r}())===u&&(t=null),r,r=te(e,t)):(ze=r,r=u),r}function lt(){var e,t=function(r){0===Ke&&Je(r)};return t(rr),r.substr(ze,2)===f?(e=f,ze+=2):e=u,e===u&&(t(er),62===r.charCodeAt(ze)?(e=l,ze++):e=u,e===u&&(t(tr),r.substr(ze,2)===s?(e=s,ze+=2):e=u,e===u&&(t(nr),r.substr(ze,2)===v?(e=v,ze+=2):e=u,e===u&&(t(ur),60===r.charCodeAt(ze)?(e=p,ze++):e=u,e===u&&(t(V),61===r.charCodeAt(ze)?(e=c,ze++):e=u,e===u&&(t(or),r.substr(ze,2)===h?(e=h,ze+=2):e=u)))))),e}function st(){var r,e,t,n,o,i;if(r=ze,(e=vt())!==u){for(t=[],n=ze,o=Qt(),(i=vt())!==u?n=o=[o,i]:(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=vt())!==u?n=o=[o,i]:(ze=n,n=u);r,r=re(e,t)}else ze=r,r=u;return r}function vt(){var r,e,t,n,o,i;if(r=ze,(e=pt())!==u){for(t=[],n=ze,o=Qt(),(i=pt())!==u?n=o=[o,i]:(ze=n,n=u);n!==u;)t.push(n),n=ze,o=Qt(),(i=pt())!==u?n=o=[o,i]:(ze=n,n=u);r,r=le(e,t)}else ze=r,r=u;return r}function pt(){var r,e;return(r=Ct())===u&&(r=ht())===u&&(r=ze,Nt()!==u?(Qt(),(e=it())!==u?(Qt(),Ft()!==u?(r,r=se(e)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u),r===u&&(r=ze,Nt()!==u?(Qt(),(e=ot())!==u?(Qt(),Ft()!==u?(r,r=ve(e)):(ze=r,r=u)):(ze=r,r=u)):(ze=r,r=u))),r}function ht(){var e,t,n;return e=ze,(t=bt())!==u?(Qt(),function(){var e;t=dr,0===Ke&&Je(t),46===r.charCodeAt(ze)?(e=m,ze++):e=u;var t;return e}()!==u?(Qt(),(n=dt())!==u?(e,e=pe(t,n)):(ze=e,e=u)):(ze=e,e=u)):(ze=e,e=u),e===u&&(e=ze,(t=bt())!==u&&(e,t=he(t)),e=t),e}function dt(){var r,e;return r=ze,(e=function(){var r,e,t,n;if(r=ze,(e=gt())!==u){for(t=[],n=mt();n!==u;)t.push(n),n=mt();r,r=me(e,t)}else ze=r,r=u;return r}())!==u?(ze,(de(e)?u:void 0)!==u?(r,r=ye(e)):(ze=r,r=u)):(ze=r,r=u),r}function yt(){var e;return(e=function(){var e,t,n,o,i=function(r){0===Ke&&Je(r)};e=ze,i(ir),34===r.charCodeAt(ze)?(t=d,ze++):t=u;if(t!==u){if(n=[],i(ar),z.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u,o!==u)for(;o!==u;)n.push(o),i(ar),z.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u;else n=u;n!==u?(i(ir),34===r.charCodeAt(ze)?(o=d,ze++):o=u,o!==u?(e,e=be(n)):(ze=e,e=u)):(ze=e,e=u)}else ze=e,e=u;return e}())===u&&(e=function(){var e,t,n,o,i=function(r){0===Ke&&Je(r)};e=ze,i(cr),39===r.charCodeAt(ze)?(t=y,ze++):t=u;if(t!==u){if(n=[],i(fr),Z.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u,o!==u)for(;o!==u;)n.push(o),i(fr),Z.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u;else n=u;n!==u?(i(cr),39===r.charCodeAt(ze)?(o=y,ze++):o=u,o!==u?(e,e=be(n)):(ze=e,e=u)):(ze=e,e=u)}else ze=e,e=u;return e}())===u&&(e=function(){var e,t,n,o,i=function(r){0===Ke&&Je(r)};e=ze,i(lr),96===r.charCodeAt(ze)?(t=b,ze++):t=u;if(t!==u){if(n=[],i(sr),W.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u,o!==u)for(;o!==u;)n.push(o),i(sr),W.test(r.charAt(ze))?(o=r.charAt(ze),ze++):o=u;else n=u;n!==u?(i(lr),96===r.charCodeAt(ze)?(o=b,ze++):o=u,o!==u?(e,e=be(n)):(ze=e,e=u)):(ze=e,e=u)}else ze=e,e=u;return e}()),e}function bt(){var r,e;return r=ze,(e=function(){var r,e,t,n;if(r=ze,(e=gt())!==u){for(t=[],n=At();n!==u;)t.push(n),n=At();r,r=me(e,t)}else ze=r,r=u;return r}())!==u?(ze,(de(e)?u:void 0)!==u?(r,r=ge(e)):(ze=r,r=u)):(ze=r,r=u),r}function gt(){var e,t;return t=vr,0===Ke&&Je(t),K.test(r.charAt(ze))?(e=r.charAt(ze),ze++):e=u,e}function mt(){var e,t;return t=pr,0===Ke&&Je(t),X.test(r.charAt(ze))?(e=r.charAt(ze),ze++):e=u,e}function At(){var e,t;return t=hr,0===Ke&&Je(t),$.test(r.charAt(ze))?(e=r.charAt(ze),ze++):e=u,e}function Ct(){var e;return(e=function(){var r,e;r=ze,(e=yt())!==u&&(r,e=Ee(e));return r=e}())===u&&(e=_t())===u&&(e=function(){var e,t;e=ze,(t=function(){var e,t,n,o,i;return e=ze,i=Ar,0===Ke&&Je(i),r.substr(ze,4).toLowerCase()===C?(t=r.substr(ze,4),ze+=4):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}())!==u&&(e,t=Ce());(e=t)===u&&(e=ze,(t=function(){var e,t,n,o;e=ze,i=Cr,0===Ke&&Je(i),r.substr(ze,5).toLowerCase()===_?(t=r.substr(ze,5),ze+=5):t=u;var i;t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u);return e}())!==u&&(e,t=_e()),e=t);return e}())===u&&(e=function(){var e,t;e=ze,(t=function(){var e,t,n,o,i;return e=ze,i=mr,0===Ke&&Je(i),r.substr(ze,4).toLowerCase()===A?(t=r.substr(ze,4),ze+=4):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}())!==u&&(e,t=Ae());return e=t}()),e}function _t(){var r,e;return r=ze,(e=function(){var r,e,t,n;r=ze,(e=Et())!==u&&(t=wt())!==u&&(n=xt())!==u?(Qt(),r,r=xe(e,t,n)):(ze=r,r=u);r===u&&(r=ze,(e=Et())!==u&&(t=wt())!==u?(n=Qt(),r,r=Se(e,t)):(ze=r,r=u),r===u&&(r=ze,(e=Et())!==u&&(t=xt())!==u?(n=Qt(),r,r=Oe(e,t)):(ze=r,r=u),r===u&&(r=ze,(e=Et())!==u?(t=Qt(),r,r=Le(e)):(ze=r,r=u))));return r}())!==u&&(r,e=we(e)),r=e}function Et(){var r;return(r=St())===u&&(r=Ot()),r}function wt(){var e,t,n,o;return e=ze,o=dr,0===Ke&&Je(o),46===r.charCodeAt(ze)?(t=m,ze++):t=u,t!==u&&(n=St())!==u?(e,e=je(n)):(ze=e,e=u),e}function xt(){var e,t,n;return e=ze,(t=function(){var e,t,n,o=function(r){0===Ke&&Je(r)};e=ze,o(br),G.test(r.charAt(ze))?(t=r.charAt(ze),ze++):t=u;t!==u?(o(gr),H.test(r.charAt(ze))?(n=r.charAt(ze),ze++):n=u,n===u&&(n=null),e,e=Re(t,n)):(ze=e,e=u);return e}())!==u&&(n=St())!==u?(e,e=Te(t,n)):(ze=e,e=u),e}function St(){var r,e,t;if(r=ze,e=[],(t=Ot())!==u)for(;t!==u;)e.push(t),t=Ot();else e=u;return e!==u&&(r,e=ke(e)),r=e}function Ot(){var e,t;return t=yr,0===Ke&&Je(t),B.test(r.charAt(ze))?(e=r.charAt(ze),ze++):e=u,e}function Lt(){var e,t,n,o,i;return e=ze,i=Sr,0===Ke&&Je(i),r.substr(ze,2).toLowerCase()===O?(t=r.substr(ze,2),ze+=2):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?e=t=[t,n]:(ze=e,e=u)):(ze=e,e=u),e}function jt(){var e,t,n,o,i;return e=ze,i=kr,0===Ke&&Je(i),r.substr(ze,2).toLowerCase()===R?(t=r.substr(ze,2),ze+=2):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Me()):(ze=e,e=u)):(ze=e,e=u),e}function Tt(){var e,t,n,o,i;return e=ze,i=Rr,0===Ke&&Je(i),r.substr(ze,2).toLowerCase()===D?(t=r.substr(ze,2),ze+=2):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=qe()):(ze=e,e=u)):(ze=e,e=u),e}function kt(){var e,t,n,o,i;return e=ze,i=Dr,0===Ke&&Je(i),r.substr(ze,4).toLowerCase()===P?(t=r.substr(ze,4),ze+=4):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Ie()):(ze=e,e=u)):(ze=e,e=u),e}function Rt(){var e,t,n,o,i;return e=ze,i=Pr,0===Ke&&Je(i),r.substr(ze,6).toLowerCase()===M?(t=r.substr(ze,6),ze+=6):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Ne()):(ze=e,e=u)):(ze=e,e=u),e}function Dt(){var e,t,n,o,i;return e=ze,i=Mr,0===Ke&&Je(i),r.substr(ze,3).toLowerCase()===q?(t=r.substr(ze,3),ze+=3):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Fe()):(ze=e,e=u)):(ze=e,e=u),e}function Pt(){var e,t,n,o,i;return e=ze,i=qr,0===Ke&&Je(i),r.substr(ze,3).toLowerCase()===I?(t=r.substr(ze,3),ze+=3):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Qe()):(ze=e,e=u)):(ze=e,e=u),e}function Mt(){var e,t,n,o,i;return e=ze,i=Ir,0===Ke&&Je(i),r.substr(ze,2).toLowerCase()===N?(t=r.substr(ze,2),ze+=2):t=u,t!==u?(n=ze,Ye(),o=gt(),Ve(!0),o===u?n=void 0:(ze=n,n=u),n!==u?(e,e=Ue()):(ze=e,e=u)):(ze=e,e=u),e}function qt(){var e,t;return t=Nr,0===Ke&&Je(t),44===r.charCodeAt(ze)?(e=F,ze++):e=u,e}function It(){var e,t;return t=Fr,0===Ke&&Je(t),42===r.charCodeAt(ze)?(e=g,ze++):e=u,e}function Nt(){var e,t;return t=Qr,0===Ke&&Je(t),40===r.charCodeAt(ze)?(e=Q,ze++):e=u,e}function Ft(){var e,t;return t=Ur,0===Ke&&Je(t),41===r.charCodeAt(ze)?(e=U,ze++):e=u,e}function Qt(){var r,e;for(r=[],e=Ut();e!==u;)r.push(e),e=Ut();return r}function Ut(){var e,t;return t=zr,0===Ke&&Je(t),Y.test(r.charAt(ze))?(e=r.charAt(ze),ze++):e=u,e}var zt={AND:!0,ASC:!0,BY:!0,CONTAINS:!0,DESC:!0,EXISTS:!0,FALSE:!0,FROM:!0,GROUP:!0,IN:!0,IS:!0,LIKE:!0,LIMIT:!0,NOT:!0,NULL:!0,OR:!0,ORDER:!0,SELECT:!0,TRUE:!0,WHERE:!0};function Zt(r,e){return{type:"unary_expr",operator:r,expr:e}}function Wt(r,e,t){return{type:"binary_expr",operator:r,left:e,right:t}}function Kt(r,e){for(var t=[r],n=0;n<e.length;n++)t.push(e[n][3]);return t}function Xt(r,e){for(var t=r,n=0;n<e.length;n++)t=Wt(e[n][1],t,e[n][3]);return t}if(Ye(),(t=i())!==u&&ze===r.length)return t;throw t!==u&&ze<r.length&&Je({type:"end"}),function(){var e=We[0],t=e.pos;return rt(e.variants,t<r.length?r.charAt(t):null,t<r.length?He(t,t+1):He(t,t))}()}Object.defineProperty(e,"__esModule",{value:!0}),e.SyntaxError=n,e.parse=u,e.default=void 0,function(r,e){function t(){this.constructor=r}t.prototype=e.prototype,r.prototype=new t}(n,Error),n.buildMessage=function(r,e){var t={literal:function(r){return'"'+u(r.text)+'"'},class:function(r){var e=r.parts.map(function(r){return Array.isArray(r)?o(r[0])+"-"+o(r[1]):o(r)});return"["+(r.inverted?"^":"")+e+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(r){return r.description},not:function(r){return"not "+i(r.expected)}};function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function u(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+n(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+n(r)})}function o(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+n(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+n(r)})}function i(r){return t[r.type](r)}return"Expected "+function(r){var e,t,n=r.map(i);if(n.sort(),n.length>0){for(e=1,t=1;e<n.length;e++)n[e-1]!==n[e]&&(n[t]=n[e],t++);n.length=t}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(r)+" but "+function(r){return r?'"'+u(r)+'"':"end of input"}(e)+" found."};var o={SyntaxError:n,parse:u};e.default=o},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transpiler=void 0;var n=t(0),u=t(1);function o(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}var i=function(){function r(){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r)}var e,t,i;return e=r,i=[{key:"_getColumnReferences",value:function(r){var e=new Set;return r.forEach(function(r){if("column_ref"!==r.type)throw new Error('Expected "'.concat(r,'"" to be a column_ref'));e.add(r.column)}),e}},{key:"_augmentWhere",value:function(r,e){var t=e.entries().next().value[0];!function r(n){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n){if("binary_expr"===n.type)if("AND"===n.operator||"OR"===n.operator)r(n.left,n.operator),r(n.right,n.operator);else if("="===n.operator){if(n.left.field||(n.left.field=n.left.column,n.left.column=t),!e.has(n.left.column))throw Error('Column "'.concat(n.left.column,'" was not specified in the Columns clause'));var o=n.left.column,i=n.left.field;if("string"!==n.right.type&&"number"!==n.right.type)throw Error("Expected a string or number, but found ".concat(n.right.type," instead"));var a=n.right.value;n.selector={table:o,selector:"[".concat(i,'="').concat(a,'"]')},n.type="selector",delete n.left,delete n.right,delete n.operator}n.parent=u}}(r)}},{key:"_constructSelectors",value:function(r,e){if(r){var t=!1,n=!1;!function r(u){if("selector"===u.type){var o=e[u.selector.table];if(n)return o.push(o[o.length-1]),n=!1,void(o[o.length-2]+=u.selector.selector);t&&(""!==o[o.length-1]&&o.push(""),t=!1),o[o.length-1]+=u.selector.selector}if("binary_expr"===u.type){var i=u.left,a=u.right;"AND"===u.operator?(r(i),r(a)):"OR"===u.operator&&("AND"===u.parent&&(n=!0),r(i),"AND"!==u.parent&&(t=!0),r(a))}}(r)}}},{key:"_compileSelectors",value:function(r,e){e="*"===e?"":e+" ";var t=[];for(var n in r){for(var u="",o=0;o<r[n].length;o++)u+=e+n+r[n][o],o<r[n].length-1&&(u+=", ");t.push(u)}return t.join(", ")}},{key:"transpile",value:function(e){var t=r._getColumnReferences(e.columns),o=e.from.table;r._augmentWhere(e.where,t);var i={};t.forEach(function(r){i[r]=[""]}),r._constructSelectors(e.where,i);var a=r._compileSelectors(i,o),c=[];return e.limit&&c.push(u.Directives.limiter.bind(null,e.limit.value)),{selector:a,engine:n.QueryEngine.getEngine(),directives:c}}}],(t=null)&&o(e.prototype,t),i&&o(e,i),r}();e.Transpiler=i}])});